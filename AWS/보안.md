![image-20201005165121584](C:\Users\jihong.kim\AppData\Roaming\Typora\typora-user-images\image-20201005165121584.png)

## 보안 & 자격 증명 및 규정 준수

###### 목차

- [CloudWatch](#CloudWatch)
- [Config](#Config)
- [CloudTrail](#CloudTrail)
- [IAM](#IAM)
- [Directory](#Directory)
- [KMS](#KMS)
- [Amazon Inspector](#Amazon-Inspector)
- [Amazon WAF](#Amazon-WAF)
- [Shield](#Shield)

### CloudWatch

> AWS 클라우드 리소스와 AWS에서 실행되는 애플리케이션을 위한 모니터링 서비스

- 지표 수집 및 추적
- 로그 파일 수집 및 모니터링
- 경보 설정
- 시스템 전반의 리소스 사용률, 애플리케이션 성능, 운영 상태 파악
- 자동 대시보드 사용
- 1초 데이터 포인트

##### 액세스

- API
- 명령줄 인터페이스
- AWS SDK 및 AWS Management Console

###### 액세스 관리 정책

> AWS 계정을 가진 사용자가 수행할 수 있는 CloudWatch 작업을 지정할 수 있도록 IAM과 통합

- 특정 리소스의 CloudWatch 데이터에 대한 액세스 제어 시 IAM 사용 :x:
- 특정 인스턴스 세트 또는 특정 LoadBalancer에 대한 CloudWatch 데이터에 대해서만 사용자 액세스 권한 부여 :x:
- IAM을 통해 부여된 권한은 CloudWatch에 사용하는 클라우드 리소스 전체에 적용
- IAM 역할은 Amazon CloudWatch 명령줄 도구와 함께 사용 :x:

##### Amazon CloudWatch Logs

> 기존 시스템, 애플리케이션 및 사용자 정의 로그 파일을 이용해 시스템 및 애플리케이션 모니터링 & 문제 해결

- 특정 구문, 값, 패턴에 대한 로그를 실시간 모니터링
- 로그 데이터
  - 안정성이 높음
  - 저렴한 스토리지에 무기한 저장 및 액세스 가능

###### 작업 수행

- 로그를 모니터링하고 저장 :point_right: 시스템 및 애플리케이션을 이해하고 운영하는 데 도움

:exclamation: **실시간 애플리케이션 및 시스템 모니터링**

- 로그 데이터를 이용해 애플리케이션과 시스템 모니터링
- 오류 비율이 임계값 초과 시 알림 전송
- 코드 변경:x:

:exclamation: **로그 장기 보존**

- 하드 드라이브 용량 걱정 :x:
- 내구성이 뛰어나고 비용 효율적인 스토리지에 무기한으로 저장 가능 :o:
- CloudWatch 로그 에이전트
  - 순환 로그 파일, 비순환 로그 파일 모두 호스트에서 로그 서비스로 쉽고 빠르게 이동
  - 원시 로그 이벤트 데이터에 엑세스 :o:

##### :globe_with_meridians: CloudWatch Logs Agent

- 호스트의 개별 로그 파일 모니터링 하는 기능

###### 지원 IAM 역할

- IAM과 통합
- 액세스 키와 IAM 역할 모두 지원

##### :globe_with_meridians: Amazon CloudWatch Logs Insights

> CloudWatch Logs를 위한 통합된 인터랙티브 로그 분석 기능

- 사용량에 따라 비용 지불
- 로그 검색 및 시각화, 애플리케이션 이해, 개선, 디버그
- CloudWatch에 통합
  - 로그 관리
  - 탐색
  - 분석
- Logs, CloudsWatch Metrics, Alarms, 대시보드 활용 :point_right: 시각적 운영
- 통찰 도출
  - 집계, 필터, 정규 표현식으로 쿼리 작성

###### 시작

- 설정이나 인프라 관리 :x:
- Management Console에서 Logs Insights에 엑세스
- AWS SDK 사용하여 애플리케잇녀을 통해 프로그래밍 방식으로 액세스

##### CloudWatch 이상 탐지

> 기계 학습 알고리즘을 적용하여 시스템 및 애플리케이션의 단일 시계열을 지속적으로 분석, 정상적인 기준 파악, 최소한의 사용자 개입으로 이상 항목을 드러냄

- 시간, 요일 기반 계절성, 변화하는 추세와 같은 자연적인 지표 패턴을 기반으로 임계값을 자동 조정하는 경보 생성
- 이상 탐지 반대를 사용하여 지표 시각화 :point_right: 예기치 않은 지표 변화 모니터링, 격리 및 문제 해결

##### :globe_with_meridians: Amazon CloudWatch Contributor Insights

> 시계열 데이터를 분석하여 시스템 성능에 가장 큰 영향을 미치는 요소를 보여줌

- 추가적인 사용자 개입 없이 연속으로 실행
- 운영 이벤트 발생 시, 개발자와 운영자가 신속하게 문제를 분리하여 진단, 복구

###### 시작

- CloudWatch 콘솔의 탐색 창에서 Contributor Insights로 이동 :point_right: Contributor Insights 규칙 생성
- 템플릿 사용

##### :globe_with_meridians: Amazon CloudWatch ServiceLens

> 애플리케이션의 상태, 성능 및 가용성을 한 곳에서 시각화하고 분석할 수 있는 새로운 기능

- CloudWatch 지표 및 로그
- AWS X-Ray의 트레이스와 결합
- 포괄적인 애플리케이션 및 애플리케이션 종속성 정보 제공
  - 성능 병목 현상 신속하게 포착
  - 애플리케이션 문제의 근본 원인 확인
  - 영향을 받는 사용자 파악
- 인프라 모니터링, 트랜잭션 모니터링, 최종 사용자 모니터링 :point_right: 세가지 주요 영역 애플리케이션 심층 분석

###### 시작

- X-Ray: 기본적으로 CloudWatch 콘솔에서 액세스 가능
- X-Ray :x:
  - X-Ray SDK 사용 :point_right: 애플리케이션에 AWS X-Ray 활성화 후 시작

##### :globe_with_meridians: Amazon CloudWatch Synthetics

> 애플리케이션 엔드포인트를 보다 쉽게 모니터링

- 1분마다 엔드포인트 검사 실행

  애플리케이션 엔드포인트가 예상과 다른 동작 시 **즉시알림**

- 맞춤 설정

- 문제 있는 애플리케이션 엔드포인트 분리 :point_right: 기본 인프라 문제로 다시 매핑

### Config

> AWS 리소스 인벤토리, 구성 기록, 구성 변경 알림 제공하여 **보안 및 거버넌스** 실현하는 완벽 관리형 서비스

- AWS 리소스 찾기
- 모든 세부 구성 정보가 포함된 AWS 리소스의 완전한 인벤토리 내보내기
- 특정 시점에 따른 리소스의 구성 방법 정하기
- 규정 준수 감사, 보안 분석, 리소스 변경 추적, 문제 해결 수행

##### 규칙

- 원하는 리소스 구성
- AWS Config에서 기록한 관련 리소스의 구성 변경과 비교하여 평가
- 대시보드에서 결과 확인
- 평가
  - 전반적인 규칙 준수 및 위험 상태
  - 시간에 따른 규칙 준수 추세 확인
  - 리소스의 규칙 미준수를 초래한 구성 변경 파악

##### 적합성 팩

> AWS Config의 공통 프레임 워크 및 패키징 모델을 사용하여 구축된 구성 규칙 및 수정 조치 모음

- Config 아티팩트를 패키징하면 여러 계정 및 리전에서 거버넌스 정책 및 구성 규칙 준수의 배포 및 보고 특징을 단순화
- 자원 규칙 미준수 상태 시간 감소

##### 이점

- 초기 투자 없이 리소스 구성 추적
- 데이터 수집/관리 간단
- AWS 리소스와 연관된 모든 구성 속성에 대해 지속적으로 업데이트된 세부 정보 볼 수 있음

##### 사용자

> 리소스 구성을 지속적으로 평가하여 AWS 보안 및 거버넌스 상태를 개선하고자 하는 AWS 고객

- Config Rules 체계화
  - 대규모 조직 관리자
  - 사용자 자체적으로 거버넌스 실현
  - 취약성을 찾기 위한 사용 활동과 구성 모니터링하는 정보 보안 전문가
  - 리소스 구서으이 변경 사항 추적, 구성 질문, 규정 준수 입증, 문제 해결 및 보안 분석

##### 규칙 미준수

> Config 규칙 및 적합성 팩: 리소스가 고객이 지정한 구성 규칙을 준수하는지에 관한 정보 제공

- 규칙 구성 방법
  - Config 규칙 리소스 구성 평가/구성 변경 감지 시 리소스 구성 평가
  - 사용자 규칙 위반, 규칙 준수 보장 :point_right: 차단:x:

##### 규칙 평가

- Config Rules
  - AWS Config에서 리소스에 대한 구성 항목(CI)을 기록한 후에 규칙 평가
  - 리소스 프로비저닝 하기 전/리소스에 대한 구성 변경 완료 전 :point_right: 규칙 평가 :x:

##### AWS CloudTrail

- :globe_with_meridians: AWS CloudTrail

  > 사용자 API 활동 기록, 활동에 대한 정보 액세스 허용
  >
  > 호출자 자격 증명, API 호출 시간, 요청 파라미터, AWS 서비스에서 반환한 응답 요소 :point_right: 전체 세부 정보 가져옴

  - API를 호출하여 리소스를 수정한 사람 :o:

- AWS Config

  - AWS 리소스에 대한 특정 시점 구성 세부 정보를 구성 항목(CI)로 기록
  - CI 사용 시, 특정 시점에 AWS 리소스 형태 :o:


##### 중앙 계정

- 여러 계정 및 리전의 규정 준수 정보 모니터링
  - 다중 계정 다중 리전 데이터 집계 기능 :point_right: 간편 상태 모니터링

##### ServiceNow 인스턴스와 Jira Service Desk 인스턴스

- 사용자가 ServiceNow 및 Jira Service Desk를 통해 AWS 리소스 관리/운영 :o:

- 사용자가 간단하게 AWS 제품 요청 작업 실행
- 관리자 AWS 제품에 대한 거버넌스 제어/감독



#### Config Rules

##### 리소스 구성

> AWS Config의 구성 항목(CI)에 포함된 데이터에 의해 정의

- 최초 릴리스를 사용하면 관련 규칙에서 리소스에 대한 CI 사용
- 다른 연결된 리소스, 업무 시간 등 정보를 사용하여 리소스의 구성 규정 준수 평가

##### 규칙

> 리소스에 대한 원하는 구성 항목의 속성 값
>
> Config에서 기록한 CI와 비교하여 규칙 평가

- AWS 관리형 규칙
  - AWS에서 사전에 구축하고 관리
  - 규칙 선택 후 몇 가지 구성 파라미터 제공
  - 자동으로 업데이트 적용
- 고객 관리형 규칙
  - 사용자 정의 규칙
  - Lambda에서 사용자 지정 규칙의 일부 호출 함수 생성
  - 전체 복사본 보유, 게정 내 규칙 실행
- 최대 150개

###### 생성

- AWS 계정 관리자 설정

###### 평가

> 특정 시점에 리소스가 규칙을 준수하는지 확인
>
> 규칙을 리소스 구성과 비교하여 평가한 결과

- 변경으로 트리거되는 규칙

  - 지정된 리소스에 대한 구성 변경을 AWS Config가 기록할 때 실행

    - 태그 키

      > 지정된 태그 키:값을 갖는 리소스에 대한 구성 변경이 기록될 때 규칙 평가가 트리거 되는 것을 의미

    - 리소스 유형

      > 지정된 리소스 유형에 해당하는 리소스에 대한 구성 변경 기록될 때 규칙 평가 트리거

    - 리소스 ID

      > 리소스 유형 및 리소스 ID에서 지정한 리소스에 대한 구성 변경이 기록될 때 규칙 평가 트리거

- 주기적인 규칙

  - 지정된 주기에 따라 트리거
  - 1, 3, 6, 12, 24 시간 주기 사용 가능
  - 모든 리소스에 대한 현재 구성 항목(CI)의 전체 스냅샷 포함

###### 규칙 준수

> 리소스가 리시소스에 적용되는 모든 규칙을 준수하는 경우 :point_right: 리소스가 규칙 준수

###### 대시 보드

- AWS Config에서 추적한 리소스의 개요와 리소스 및 규칙의 현재 준수 상태에 대한 요약을 제공
- 리소스 규칙 준수 요약 정보를 사용해 리소스의 Config 타임 라인 보기를 자세히 살펴봄
  - 변경된 구성 파라미터 확인

#### 적합성 팩

> 여러 계정을 관리할 때 규정 준수 관리 및 대규모 보고를 단순화하기 위한 것
>
> 팩 수준에서 종합적인 규정 준수 보고 기능 및 불변성을 제공하도록 설계

##### 사용

- 전체 조직에 배포할 수 있는 단일 개체에 대한 수정 조치와 함께 패키징 규칙의 추가적 이점 제공
- 개별 AWS Config 규칙을 사용하여 하나 이상의 계정에서 리소스 구성 규칙 준수 평가
- 개별 멤버 계정으로 수정, 삭제 불가능
- CLI, Console을 통해 샘플 템플릿 중 하나를 사용하여 적합성 팩 생성 :point_right: YAML로 작성

##### Security Hub

> 보안 및 규정 준수 상태 관리를 서비스 형태로 제공하는 보안 및 규정 준수 서비스

- Config 규칙을 기본 매커니즘으로 하여 AWS 리소스의 구성 평가
- 리소스 구성을 직접 평가하는 데 사용

###### 사용

- PCI DSS와 같은 규정 준수 표준 존재
  - 완전관리형 AWS Security Hub 서비스가 표준을 운용하는 데 가장 쉬움
  - Detective와 Security Hub의 통합을 통해 결과 
  - EventBridge와 Security Hub의 통합을 사용해 자동화/반자동화 방식의 수정 조치 구성
  - :-1: 보안, 운용, 비용 최적화 확인을 포함할 수 있는 자체 규정 준수/보안 표준 결합하려는 경우 Config 적합성 팩 적합

###### Config 적합성 팩

- Config 규칙 그룹과 관련 수정 조치를 단일 엔터티로 패키징 :point_right: Config 규칙 관리 단순화
- 조직 전체에 걸친 규칙 배포와 수정 조치 단순화
- 규정 준수 요약이 팩 수준에서 보고될 수 있음 :point_right: 집계 보고 사용

#### 다중 계정 다중 리전 데이터 집계

##### 데이터 집계 기능

> 여러 계정과 리전의 Config 데이터 단일 계정에 집계

- 다중 계정 데이터 집계

  > 중앙 IT 관리자가 엔터프라이즈의 여러 AWS 계정에 대한 규정 준수 모니터링

###### 데이터 집계 기능 Config 규칙 프로비저닝 :x:

- 여러 계정에서 규칙을 프로비저닝 하는 데 사용 :x:
- 규정 준수에 대한 가시성 제공하는 보고 기능만 제공

##### 집계자

> 여러 계정과 리전에서 AWS Config 데이터를 수집하는 AWS Config 리소스 유형
>
> 여러 계정과 리전에 대해 Config에 기록된 리소스 구성과 규정 준수 데이터 확인

##### 집계 보기 페이지

- 조직 전체의 총 미준수 규칙수, 리소스 수 제공 (상위 5개)
- 사용자가 드릴다운하여 규칙을 위반한 리소스에 대한 세부 정보와 계정에서 위반하고 있는 규칙 목록 확인



### CloudTrail

### IAM

### Directory

### KMS

### Amazon Inspector

### Amazon WAF

### Shield
